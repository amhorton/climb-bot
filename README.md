# sherpa

sherpa is a chat bot built on the [Hubot][hubot] framework. It was
initially generated by [generator-hubot][generator-hubot].

## sherpa-specific documentation

### Running sherpa Locally

First, `yarn install`.

Then, you need to set up your config file. Create a file named `config` in the parent directory. You can copy and paste the contents of `sample_config` for now.

If you are doing something simple that doesn't require specific slack integrations or spotify, you can just `yarn start` and take a look at the very cool sherpa that should be running in your terminal. Depending on what you are working on, you may need [Redis](https://redis.io/) installed as well.

If you want to deploy your local sherpa to our slack, [go here](https://climbcredit.slack.com/apps/A0F7YS25R-bots?page=1) and then click `Add configuration`. That will generate a token which you can paste into your local `config` file under `HUBOT_SLACK_TOKEN`. We recommend naming your bot `sherpa-{your name}`.

If you are working on the spotify integration, you will need to follow some more complicated steps. See the "Spotify" section.

### Spotify
So, you want to work on our spotify integration? There are a couple setup steps you'll need to take.

In order to work with the spot integration, you'll need Redis installed (see above), and you'll need access to a spotify account with premium activated. Sorry, takes money to make money. D:

Once you have that, go to [your Spotify developer dashboard](https://beta.developer.spotify.com/dashboard/applications). You may need to log in.

Once you see a button to "CREATE AN APP", click that. Assure Spotify you won't use your app for commercial purposes, and choose a name for your new Spotify app, probably Sherpa-{YOUR NAME}.

In the home page for that app, you'll see a `Client ID` and a `Client Secret`. Copy those down for later.

Click `Edit Settings` in the top right, find the section where it says `Redirect URIs`. Add `http://localhost:8888/callback` to your redirects, then scroll to the bottom and hit `Save`.

Then, crack open the climb-bot repo and take a look at `util/spotify/authorizer/app.js`. You'll see spots at the top of the file for you to paste your client ID and client secret that were defined earlier. Paste that stuff in, then do `yarn run spotify:authorizer` and navigate to `localhost:8888` in your browser. (PS: I stole the authorizer form [here](https://github.com/spotify/web-api-auth-examples))

Click `Log in with Spotify`, then log in with the credentials for your premium account. You'll be redirected to a page that has a `Refresh Token` and an `Access Token` displayed. Copy the refresh token.

Last step! take a look at the `sample_config` file. Open the `config` file that you created earlier and paste the contents of the `sample_config` into `config`. Then edit the relevant Spotify keys with the correct tokens (client ID, client secret, refresh token). While you're here, add `SPOTIFY_USER_ID`, which should be the name of your premium user (default is ???, which is the user sherpa uses) and `SPOTIFY_PLAYLIST_ID`, which is the ID of the default playlist you'd like to use for local development. NB: the `SPOTIFY_USER_ID` should be the ID for the owner of configured playlist, and that playlist should be set to public in spotify.

So, what did this all do? Well, if you `yarn start` sherpa with Spotify open on your computer and start giving sherpa spotify commands (like maybe `sherpa play spotify:track:4jDmJ51x1o9NZB5Nxxc7gY`), sherpa will take control of the spotify on your computer! Pretty cool, and pretty useful for local development. No more messing with everyone else's music!

If that is all working for you, the last step is to revert `util/spotify/authorizer/app.js` back to the way it was before you changed it (probably with `git checkout`). Don't commit your Spotify keys! :)

## Hubot documentation

### Scripting

An example script is included at `scripts/example.coffee`, so check it out to
get started, along with the [Scripting Guide][scripting-docs].

For many common tasks, there's a good chance someone has already one to do just
the thing.

[scripting-docs]: https://github.com/github/hubot/blob/master/docs/scripting.md

### external-scripts

There will inevitably be functionality that everyone will want. Instead of
writing it yourself, you can use existing plugins.

Hubot is able to load plugins from third-party `npm` packages. This is the
recommended way to add functionality to your hubot. You can get a list of
available hubot plugins on [npmjs.com][npmjs] or by using `npm search`:

    % npm search hubot-scripts panda
    NAME             DESCRIPTION                        AUTHOR DATE       VERSION KEYWORDS
    hubot-pandapanda a hubot script for panda responses =missu 2014-11-30 0.9.2   hubot hubot-scripts panda
    ...


To use a package, check the package's documentation, but in general it is:

1. Use `npm install --save` to add the package to `package.json` and install it
2. Add the package name to `external-scripts.json` as a double quoted string

You can review `external-scripts.json` to see what is included by default.
